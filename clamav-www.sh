#!/bin/bash

LOGFILE="/var/log/clamav/clamav-$(date +'%Y-%m-%d').log";

LOGFILE2="/var/log/clamav/lmd-$(date +'%Y-%m-%d').log";



EMAIL_MSG="Please see the log file attached.";
EMAIL_FROM="clamav-daily@example.com";
EMAIL_TO="username@example.com";
DIRTOSCAN="/usr/share/nginx";

for S in ${DIRTOSCAN}; do

 echo "Starting a daily scan of "$S" directory";
 freshclam >> "$LOGFILE";
 clamscan -ri --follow-dir-symlinks=2 --follow-file-symlinks=2 --move=/usr/share/infected "$S" >> "$LOGFILE";
 # get the value of "Infected lines"

 MALWARE=$(tail "$LOGFILE"|grep Infected|cut -d" " -f3);

 echo  "$(date +'%Y-%m-%d')  CLAMAV at xxx.xxx FOUND $MALWARE " >> "$LOGFILE";

 #python  /var/moni/send_tg.py " $(date +'%Y-%m-%d')  CLAMAV at xxx.xxx.xxx.xxx FOUND $MALWARE "  >> "$LOGFILE" ;

 # if the value is not equal to zero, send an email with the log file attached
 if [  "$MALWARE" -ne "0" ] ;then
     python  /var/moni/send_tg.py "!!!  $(date +'%Y-%m-%d')  CLAMAV at xxx.xxx.xxx.xxx FOUND $MALWARE "; >> "$LOGFILE";

 fi


done

exit 0
